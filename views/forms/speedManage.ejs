<!DOCTYPE html>
<!--[if lt IE 7]>      <html class='no-js lt-ie9 lt-ie8 lt-ie7'> <![endif]-->
<!--[if IE 7]>         <html class='no-js lt-ie9 lt-ie8'> <![endif]-->
<!--[if IE 8]>         <html class='no-js lt-ie9'> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
    <!--<![endif]-->
    <%- include('../includes/head') %>
    <body>
        <%- include('../includes/header') %>
        <div class="container-fluid">
            <div class="row">
                <%- include('../includes/nav') %>
                <div
                    class="
                    card 
                    col-xl-10 
                    offset-xl-2 
                    col-9 
                    offset-3 
                    col-md-9 
                    offset-md-3 
                    col-lg-10 
                    offset-lg-2 
                    col-sm-8 
                    offset-sm-4 
                    mr-1"
                    >
                    <div class="card-header"><h3><%= card_header %></h3></div>
                    <div class="card-body">
                        <div class="">
                            <form id="driver-form">
                                <div class="form-row">
                                    <div class="form-group col">
                                        <label for="first_name">First Name</label>
                                        <select 
                                            name="racing_number"
                                            class="form-control racing_number_select"
                                            >
                                            </select>
                                    </div>
                                    <div class="form-group col">
                                        <label for="last_name">Last Name</label>
                                        <select name="driver_id" class="form-control" value="<%= form && form.last_name %>"></select>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <!--[if lt IE 7]>
            <p class="browsehappy">
                You are using an <strong>outdated</strong> browser. Please
                <a href="#">upgrade your browser</a> to improve your experience.
            </p>
        <![endif]-->
        <script>
            $(document).ready(function(){
                $('#driver-form').submit(function(event){
                    const data = $(this).serialize();
                    event.preventDefault();
                    $.ajax({
                        url: "<%= action %>",
                        method: "<%= method %>",
                        data,
                        success: function(result){
                            alert('success');
                        },
                        error: function(){
                            alert('error');
                        }
                    })
                })
            });

            $('.racing_number_select').select2({
                ajax:{
                    url:'/api/drivers',
                    data: function (params) {
                        var query = {
                            search: params.term,
                            page: params.page || 1
                        }

                        // Query parameters will be ?search=[term]&page=[page]
                        return query;
                    }
                }
            })
        </script>
    </body>
</html>
